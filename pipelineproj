pipeline {
    agent any

    parameters {
        string(name: 'NAME', description: 'Please tell me your name')
        choice(name: 'MONTH', choices: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'], description: 'Choose the starting month')
        choice(name: 'DAY', choices: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31'], description: 'Enter the day of the month')
    }

    stages {
        stage('Initialize Goals') {
            steps {
                script {
                    def goalsByMonth = [
                        'January': ["Buy a Diary if still not the case", "Write about your feeling of the past years", "Write about your daily experience"],
                        'February': ["Change the furniture arrangement", "Buy and dispose some/new plants", "Buy a new and more flexible desk (sit-stand)"],
                        'March': ["Exercise more", "Eat better", "Have more time for yourself"],
                        'April': ["Helping an elderly to cross the street", "Give clothes to a charity for children", "Bring breakfast for colleagues at the office"],
                        'May': ["Take dance lessons", "Sign up for Marathon", "Take a trip with someone you never had"],
                        'June': ["Visit parent’s home", "Organise a trip with your friends", "3 restaurants with your girlfriend"],
                        'July': ["Enjoy a Summer festival", "Have a party with your relatives", "Go to a concert of one of your friend’s favorite artists"],
                        'August': ["Find a hotel near the sea for a week-end", "Rent a van in order to go to the destination", "Buy camping equipment"],
                        'September': ["Find a few hiking trails near your place", "Find relatives with whom you will go", "Choose two hikes you will go on with them"],
                        'October': ["Learn a new language", "Read 3 books", "Learn a manual activity (origami, calligraphy, lock picking)"],
                        'November': ["Find an instrument that you like", "Take classes and lessons to learn better", "Record a cover for a song that you like and show it to your relatives"],
                        'December': ["Create a daily breathing program (meditation)", "Attend a yoga class", "Ask those you love to come take a yoga class with you"]
                    ]

                    env.GOALS_BY_MONTH = goalsByMonth
                    env.USER_PROGRESS = []
                }
            }
        }

        stage('Execute Monthly Goals') {
            steps {
                script {
                    def goals = env.GOALS_BY_MONTH[params.MONTH]

                    if (goals == null || goals.isEmpty()) {
                        echo "No goals defined for ${params.MONTH}."
                        return
                    }

                    for (goal in goals) {
                        echo "Objective: ${goal}"

                        def result = input message: "${params.NAME}, have you completed this goal on day ${params.DAY}?", parameters: [
                            booleanParam(name: 'COMPLETED', defaultValue: false, description: goal)
                        ]

                        if (result) {
                            echo "Bravo ${params.NAME}! Vous avez accompli votre objectif : ${goal}"
                            env.USER_PROGRESS.add([goal: goal, status: 'Completed'])
                        } else {
                            echo "Dommage ${params.NAME}! Vous pouvez compléter cet objectif plus tard : ${goal}"
                            env.USER_PROGRESS.add([goal: goal, status: 'Not Completed'])
                        }
                    }
                }
            }
        }

        stage('Save Progress') {
            steps {
                script {
                    def progressFile = "progress_${params.MONTH}_${params.NAME}.txt"
                    writeFile file: progressFile, text: env.USER_PROGRESS.toString()
                    echo "Progress saved to ${progressFile}"
                }
            }
        }

        stage('Notify Completion') {
            steps {
                script {
                    echo "All goals for ${params.MONTH} have been processed for ${params.NAME}. Here is the summary:"
                    env.USER_PROGRESS.each { progress ->
                        echo "Objective: ${progress.goal}, Status: ${progress.status}"
                    }
                }
            }
        }
    }
}
