pipeline {
    agent any

    parameters {
        choice(name: 'MONTH', choices: ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE', 'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'], description: 'Select the month to start the process')
        string(name: 'DAY', defaultValue: '1', description: 'Enter the day of the month (e.g., 1, 15, 25)')
    }

    stages {
        stage('Initialize') {
            steps {
                script {
                    // Define objectives for each month
                    env.OBJECTIVES = new groovy.json.JsonBuilder([
                        'JANUARY': [
                            'Buy a Diary if still not the case.',
                            'Write about your feeling of the past years.',
                            'Write about your daily experience.'
                        ],
                        'FEBRUARY': [
                            'Change the furniture arrangement.',
                            'Buy and dispose some/new plants.',
                            'Buy a new and more flexible desk (sit-stand).'
                        ],
                        'MARCH': [
                            'Exercise more (make yourself a program that you have to respect).',
                            'Eat better (healthy meals, local ingredients, less meat,...).',
                            'Have more time for yourself.'
                        ],
                        'APRIL': [
                            'Helping an elderly to cross the street.',
                            'Give clothes to a charity for children.',
                            'Bring breakfast for colleagues at the office.'
                        ],
                        'MAY': [
                            'Take dance lessons (whatever the dance is, learn it !).',
                            'Sign up for Marathon (or semi-marathon).',
                            'Take a trip with someone you never had (friend, family member, partner).'
                        ],
                        'JUNE': [
                            'Visit parent’s home.',
                            'Organise a trip with your friends.',
                            '3 restaurants with your girlfriend.'
                        ],
                        'JULY': [
                            'Enjoy a Summer festival.',
                            'Have a party with your relatives.',
                            'Go to a concert of one of your friend’s favorite artists.'
                        ],
                        'AUGUST': [
                            'Find a hotel near the sea for a week-end.',
                            'Rent a van in order to go to the destination.',
                            'Buy camping equipment.'
                        ],
                        'SEPTEMBER': [
                            'Find a few hiking trails near your place.',
                            'Find relatives with whom you will go.',
                            'Choose two hikes you will go on with them.'
                        ],
                        'OCTOBER': [
                            'Learn a new language.',
                            'Read 3 books.',
                            'Learn a manual activity (origami, calligraphy, lock picking).'
                        ],
                        'NOVEMBER': [
                            'Find an instrument that you like.',
                            'Take classes and lessons to learn better.',
                            'Record a cover for a song that you like and show it to your relatives.'
                        ],
                        'DECEMBER': [
                            'Create a daily breathing program (meditation).',
                            'Attend a yoga class.',
                            'Ask those you love to come take a yoga class with you.'
                        ]
                    ]).toString()

                    env.MONTHS = ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE', 'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER']
                }
            }
        }

        // Create a stage dynamically for each month
        stage('Process Each Month') {
            steps {
                script {
                    def currentMonthIndex = env.MONTHS.indexOf(params.MONTH)

                    for (int i = currentMonthIndex; i < currentMonthIndex + 12; i++) {
                        def month = env.MONTHS[i % 12]
                        def monthObjectives = new groovy.json.JsonSlurper().parseText(env.OBJECTIVES)[month]

                        stage("${month} Objectives") {
                            steps {
                                script {
                                    echo "Processing objectives for ${month}"

                                    for (task in monthObjectives) {
                                        def result = input message: "Have you completed the objective: '${task}'?", \
                                                     parameters: [choice(name: 'Completion Status', choices: ['Completed', 'Not Completed'], description: 'Select the status')]

                                        if (result == 'Completed') {
                                            echo "Objective completed: ${task}"
                                        } else {
                                            echo "Objective not completed: ${task}"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    post {
        always {
            echo 'Pipeline execution finished. All months have been processed.'
        }
    }
}
