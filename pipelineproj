pipeline {
    agent any

    parameters {
        choice(name: 'MONTH', choices: ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE', 'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'], description: 'Select the month you want to view objectives for')
    }

    stages {
        stage('Display Objectives') {
            steps {
                script {
                    // Define objectives per month
                    def objectives = [
                        'JANUARY': [
                            'Buy a Diary if still not the case.',
                            'Write about your feeling of the past years.',
                            'Write about your daily experience.'
                        ],
                        'FEBRUARY': [
                            'Change the furniture arrangement.',
                            'Buy and dispose some/new plants.',
                            'Buy a new and more flexible desk (sit-stand).'
                        ],
                        'MARCH': [
                            'Exercise more (make yourself a program that you have to respect).',
                            'Eat better (healthy meals, local ingredients, less meat,...).',
                            'Have more time for yourself.'
                        ],
                        'APRIL': [
                            'Helping an elderly to cross the street.',
                            'Give clothes to a charity for children.',
                            'Bring breakfast for colleagues at the office.'
                        ],
                        'MAY': [
                            'Take dance lessons (whatever the dance is, learn it !).',
                            'Sign up for Marathon (or semi-marathon).',
                            'Take a trip with someone you never had (friend, family member, partner).'
                        ],
                        'JUNE': [
                            'Visit parent’s home.',
                            'Organise a trip with your friends.',
                            '3 restaurants with your girlfriend.'
                        ],
                        'JULY': [
                            'Enjoy a Summer festival.',
                            'Have a party with your relatives.',
                            'Go to a concert of one of your friend’s favorite artists.'
                        ],
                        'AUGUST': [
                            'Find a hotel near the sea for a week-end.',
                            'Rent a van in order to go to the destination.',
                            'Buy camping equipment.'
                        ],
                        'SEPTEMBER': [
                            'Find a few hiking trails near your place.',
                            'Find relatives with whom you will go.',
                            'Choose two hikes you will go on with them.'
                        ],
                        'OCTOBER': [
                            'Learn a new language.',
                            'Read 3 books.',
                            'Learn a manual activity (origami, calligraphy, lock picking).'
                        ],
                        'NOVEMBER': [
                            'Find an instrument that you like.',
                            'Take classes and lessons to learn better.',
                            'Record a cover for a song that you like and show it to your relatives.'
                        ],
                        'DECEMBER': [
                            'Create a daily breathing program (meditation).',
                            'Attend a yoga class.',
                            'Ask those you love to come take a yoga class with you.'
                        ]
                    ]

                    // Retrieve the objectives for the selected month
                    def selectedMonth = params.MONTH
                    def selectedObjectives = objectives[selectedMonth]

                    // Display objectives to the user
                    echo "Selected Month: ${selectedMonth}"
                    echo "Objectives:"
                    selectedObjectives.each { obj ->
                        echo "- ${obj}"
                    }
                }
            }
        }

        stage('User Interaction') {
            steps {
                script {
                    // Generate a checkbox form for the user to tick completed tasks
                    def completedTasks = input message: "Mark completed tasks for ${params.MONTH}",
                                           parameters: objectives[params.MONTH].collect { task -> booleanParam(name: task, description: task, defaultValue: false) }

                    // Save completed tasks
                    def results = [:]
                    objectives[params.MONTH].each { task ->
                        results[task] = completedTasks[task]
                    }

                    // Print and save results
                    echo "Tasks completed for ${params.MONTH}:"
                    results.each { task, done ->
                        echo "- ${task}: ${done ? 'DONE' : 'NOT DONE'}"
                    }

                    // Save results in an environment variable or file
                    writeFile file: "${params.MONTH}_progress.json", text: groovy.json.JsonOutput.toJson(results)
                }
            }
        }
    }

    post {
        always {
            echo 'Pipeline execution completed.'
        }
    }
}
