pipeline {
    agent any

    parameters {
        choice(name: 'START_MONTH', choices: 'JANUARY\nFEBRUARY\nMARCH\nAPRIL\nMAY\nJUNE\nJULY\nAUGUST\nSEPTEMBER\nOCTOBER\nNOVEMBER\nDECEMBER', description: 'Choisissez le mois de départ')
        string(name: 'START_DAY', defaultValue: '1', description: 'Entrez le jour de départ (1-31)')
    }

    stages {
        stage('Initialize') {
            steps {
                script {
                    def goalsByMonth = [
                        JANUARY: ["Buy a Diary if still not the case", "Write about your feeling of the past years", "Write about your daily experience"],
                        FEBRUARY: ["Change the furniture arrangement", "Buy and dispose some/new plants", "Buy a new and more flexible desk (sit-stand)"],
                        MARCH: ["Exercise more", "Eat better", "Have more time for yourself"],
                        APRIL: ["Helping an elderly to cross the street", "Give clothes to a charity for children", "Bring breakfast for colleagues at the office"],
                        MAY: ["Take dance lessons", "Sign up for Marathon", "Take a trip with someone you never had"],
                        JUNE: ["Visit parent’s home", "Organise a trip with your friends", "3 restaurants with your girlfriend"],
                        JULY: ["Enjoy a Summer festival", "Have a party with your relatives", "Go to a concert of one of your friend’s favorite artists"],
                        AUGUST: ["Find a hotel near the sea for a week-end", "Rent a van in order to go to the destination", "Buy camping equipment"],
                        SEPTEMBER: ["Find a few hiking trails near your place", "Find relatives with whom you will go", "Choose two hikes you will go on with them"],
                        OCTOBER: ["Learn a new language", "Read 3 books", "Learn a manual activity (origami, calligraphy, lock picking)"],
                        NOVEMBER: ["Find an instrument that you like", "Take classes and lessons to learn better", "Record a cover for a song that you like and show it to your relatives"],
                        DECEMBER: ["Create a daily breathing program (meditation)", "Attend a yoga class", "Ask those you love to come take a yoga class with you"]
                    ]

                    env.GOALS_BY_MONTH = goalsByMonth
                    env.START_MONTH_INDEX = ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE', 'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'].indexOf(params.START_MONTH)
                    env.USER_PROGRESS = [:]
                }
            }
        }

        stage('Execute Goals') {
            steps {
                script {
                    def months = ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE', 'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER']
                    def startIndex = env.START_MONTH_INDEX as Integer
                    def goalsByMonth = env.GOALS_BY_MONTH

                    for (int i = startIndex; i < months.size(); i++) {
                        def currentMonth = months[i]
                        def goals = goalsByMonth[currentMonth]

                        echo "Executing for month: ${currentMonth}"

                        def timePeriods = ["1-10", "11-20", "21-end"]

                        for (int j = 0; j < goals.size(); j++) {
                            def goal = goals[j]
                            def period = timePeriods[j]

                            echo "Objective: ${goal} (Period: ${period})"

                            input message: "Avez-vous complété cet objectif pour ${currentMonth} (${period}) ?", parameters: [
                                booleanParam(name: goal, defaultValue: false, description: goal)
                            ]

                            script {
                                if (!env.USER_PROGRESS.containsKey(currentMonth)) {
                                    env.USER_PROGRESS[currentMonth] = [:]
                                }

                                env.USER_PROGRESS[currentMonth][goal] = params[goal]
                            }
                        }

                        echo "Progress for ${currentMonth}: ${env.USER_PROGRESS[currentMonth]}"
                    }
                }
            }
        }

        stage('Save Progress') {
            steps {
                script {
                    echo "Final Progress: ${env.USER_PROGRESS}"
                }
            }
        }
    }
}
